<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Labbing with D3 and moduling">
  <meta name="author" content="Niklas Ek">

  <title>D3 Graphing</title>
  <link rel="stylesheet" href="style.css">

</head>
<body>
  <div id="monastery">
    <h1>Graphs!</h1>
    <button id="toggleStacked">Toggle Stacked</button>
    <div id="graphs5"></div>
    <div id="graphs"></div>
    <div id="graphs2"></div>
    <div id="graphs3"></div>
    <div id="graphs4"></div>
  </div>

  <!--<script src="http://d3js.org/d3.v3.min.js"></script>-->
  <script src="d3.v3.min.js"></script>
  <script src="wisdom/Graphest.js"></script>
  <script>

  /*

    Graphest

  */


var kairosResponse = {"queries":[
  {
    "sample_size":120,
    "results":[
      {
        "name": "cpu.0.cpu.system",
        "tags": {
          "host":["ash2-riemann-a1.ash2.spotify.net"],
          "role":["riemann"]
        },
        "values":[
          [1386709975964,1390662*0.999],[1386710005964,1390691*0.999],[1386710035964,1390705*0.999],[1386710065964,1390726*0.999],[1386710095964,1390742*0.999],[1386710125965,1390755*0.999],[1386710155963,1390771*0.999],[1386710185964,1390787*0.999],[1386710215964,1390809*0.999],[1386710245964,1390839*0.999],[1386710275964,1390865*0.998],[1386710305964,1390884*0.998],[1386710335965,1390894*0.998],[1386710365964,1390914*0.998],[1386710395964,1390929*0.998],[1386710425965,1390941*0.998],[1386710455963,1390955*0.998],[1386710485965,1390970*0.998],[1386710515964,1390986*0.998],[1386710545963,1390994*0.998],[1386710575964,1391004*0.998],[1386710605964,1391030*0.998],[1386710635964,1391044*0.998],[1386710665965,1391060*0.998],[1386710695964,1391075*0.998],[1386710725964,1391100*0.998],[1386710755964,1391112*0.998],[1386710785964,1391126*0.998],[1386710815964,1391140*0.999],[1386710845964,1391169*0.999],[1386710875964,1391180*0.999],[1386710905964,1391198*0.999],[1386710935964,1391220*0.999],[1386710965964,1391245*0.999],[1386710995964,1391261*0.999],[1386711025964,1391272*0.999],[1386711055964,1391286*0.999],[1386711085964,1391300*0.999],[1386711115964,1391316*0.999],[1386711145965,1391339*0.999],[1386711175964,1391350*0.999],[1386711205965,1391375*0.999],[1386711235964,1391387*0.999],[1386711265964,1391402*0.999],[1386711295964,1391423*0.999],[1386711325964,1391458*0.999],[1386711355964,1391466*0.999],[1386711385964,1391476*0.999],[1386711415964,1391492*0.999],[1386711445964,1391506*0.999],[1386711475965,1391516*0.999],[1386711505964,1391534*0.999],[1386711535964,1391555*0.999],[1386711565964,1391581*0.999],[1386711595964,1391590*0.999],[1386711625964,1391613*0.999],[1386711655964,1391626*0.999],[1386711685963,1391636*0.999],[1386711715964,1391662*0.999],[1386711745964,1391671*0.999],[1386711775964,1391678*0.999],[1386711805964,1391699*0.999],[1386711835963,1391721*0.999],[1386711865964,1391732*0.999],[1386711895964,1391740*0.999],[1386711925965,1391772*0.999],[1386711955964,1391797*0.999],[1386711985963,1391819*0.999],[1386712015965,1391848*0.999],[1386712045964,1391872*0.999],[1386712075964,1391896*0.999],[1386712105964,1391920*0.999],[1386712135964,1391934*0.999],[1386712165964,1391950*0.999],[1386712195965,1391969*0.999],[1386712225964,1391984*0.999],[1386712255964,1392009*0.999],[1386712285964,1392020*0.999],[1386712315964,1392038*0.999],[1386712345964,1392049*0.999],[1386712375964,1392077*0.999],[1386712405964,1392103*0.999],[1386712435964,1392116*0.999],[1386712465967,1392125*0.999],[1386712495964,1392140*0.999],[1386712525964,1392159*0.999],[1386712555964,1392177*0.999],[1386712585963,1392189*0.999],[1386712615964,1392201*0.999],[1386712645964,1392223*0.999],[1386712675965,1392232*0.999],[1386712705964,1392250*0.999],[1386712735963,1392261*0.999],[1386712765964,1392269*0.999],[1386712795964,1392284*0.999],[1386712825964,1392306*0.999],[1386712855964,1392319*0.999],[1386712885964,1392345*0.999],[1386712915962,1392362*0.999],[1386712945964,1392373*0.999],[1386712975964,1392388*0.999],[1386713005965,1392411*0.999],[1386713035964,1392433*0.999],[1386713065964,1392441*0.999],[1386713095965,1392458*0.999],[1386713125965,1392482*0.999],[1386713155964,1392495*0.999],[1386713185964,1392503*0.999],[1386713215964,1392511*0.999],[1386713245964,1392527*0.999],[1386713275964,1392546*0.999],[1386713305964,1392589*0.999],[1386713335963,1392619*0.999],[1386713365963,1392716*0.999],[1386713395962,1392732*0.999],[1386713425964,1392751*0.999],[1386713455964,1392761*0.999],[1386713485964,1392778*0.999],[1386713515967,1392788*0.999],[1386713545964,1392798*0.999]
        ]
      },
      {
        "name": "cpu.0.cpu.system-small",
        "renderer": "line",
        "tags": {
          "host":["ash2-riemann-a1.ash2.spotify.net"],
          "role":["riemann"]
        },
        "values":[
          [1386709975964,1390662],[1386710005964,1390691],[1386710035964,1390705],[1386710065964,1390726],[1386710095964,1390742],[1386710125965,1390755],[1386710155963,1390771],[1386710185964,1390787],[1386710215964,1390809],[1386710245964,1390839],[1386710275964,1390865],[1386710305964,1390884],[1386710335965,1390894],[1386710365964,1390914],[1386710395964,1390929],[1386710425965,1390941],[1386710455963,1390955],[1386710485965,1390970],[1386710515964,1390986],[1386710545963,1390994],[1386710575964,1391004],[1386710605964,1391030],[1386710635964,1391044],[1386710665965,1391060],[1386710695964,1391075],[1386710725964,1391100],[1386710755964,1391112],[1386710785964,1391126],[1386710815964,1391140],[1386710845964,1391169],[1386710875964,1391180],[1386710905964,1391198],[1386710935964,1391220],[1386710965964,1391245],[1386710995964,1391261],[1386711025964,1391272],[1386711055964,1391286],[1386711085964,1391300],[1386711115964,1391316],[1386711145965,1391339],[1386711175964,1391350],[1386711205965,1391375],[1386711235964,1391387],[1386711265964,1391402],[1386711295964,1391423],[1386711325964,1391458],[1386711355964,1391466],[1386711385964,1391476],[1386711415964,1391492],[1386711445964,1391506],[1386711475965,1391516],[1386711505964,1391534],[1386711535964,1391555],[1386711565964,1391581],[1386711595964,1391590],[1386711625964,1391613],[1386711655964,1391626],[1386711685963,1391636],[1386711715964,1391662],[1386711745964,1391671],[1386711775964,1391678],[1386711805964,1391699],[1386711835963,1391721],[1386711865964,1391732],[1386711895964,1391740],[1386711925965,1391772],[1386711955964,1391797],[1386711985963,1391819],[1386712015965,1391848],[1386712045964,1391872],[1386712075964,1391896],[1386712105964,1391920],[1386712135964,1391934],[1386712165964,1391950],[1386712195965,1391969],[1386712225964,1391984],[1386712255964,1392009],[1386712285964,1392020],[1386712315964,1392038],[1386712345964,1392049],[1386712375964,1392077],[1386712405964,1392103],[1386712435964,1392116],[1386712465967,1392125],[1386712495964,1392140],[1386712525964,1392159],[1386712555964,1392177],[1386712585963,1392189],[1386712615964,1392201],[1386712645964,1392223],[1386712675965,1392232],[1386712705964,1392250],[1386712735963,1392261],[1386712765964,1392269],[1386712795964,1392284],[1386712825964,1392306],[1386712855964,1392319],[1386712885964,1392345],[1386712915962,1392362],[1386712945964,1392373],[1386712975964,1392388],[1386713005965,1392411],[1386713035964,1392433],[1386713065964,1392441],[1386713095965,1392458],[1386713125965,1392482],[1386713155964,1392495],[1386713185964,1392503],[1386713215964,1392511],[1386713245964,1392527],[1386713275964,1392546],[1386713305964,1392589],[1386713335963,1392619],[1386713365963,1392716],[1386713395962,1392732],[1386713425964,1392751],[1386713455964,1392761],[1386713485964,1392778],[1386713515967,1392788],[1386713545964,1392798]
        ]
      }
    ]
  }
]}

var kairosFormatedData = kairosResponse.queries[0].results.map(function(series, i){
  var dataPoints = series.values.map(function(point){
    var pointObj = {x: point[0], y: point[1]};
    return pointObj;
  });
  delete series.values;
  series.dataPoints = dataPoints;
  return series;
});




  var genData = function(series, points){
    if(!series) var series = 1;
    if(!points) var points = 10;

    var dataset = [];
    var newX = 0;
    var newY, i, j;

    for(i=0; i<points; i++){
      newX += 1;
      for(j=0; j<series; j++){
        oldY = Math.round(Math.random()*10);
        if(!dataset[j]) dataset.push({dataPoints: []});
        if(dataset[j].dataPoints[i-1]) oldY = dataset[j].dataPoints[i-1].y;

        newY = oldY + Math.round(Math.random()*20)-10;
        newY = newY > 100 ? 100 : newY;
        newY = newY < 0 ? 0 : newY;

        if(!dataset[j].name) dataset[j].name = "series"+j;
        if(j%2 === 0 && !dataset[j].renderer) dataset[j].renderer = "line";
        dataset[j].dataPoints.push( {x: newX, y:  newY} );
      }
    }
    return dataset;
  }

  var graphData = genData(10, 100);
  var graphData2 = genData(4, 10);
  var graphData3 = genData(6, 100);
  var graphData4 = genData(3, 100);

  colors = ["navy", "blue", "teal", "green", "forest", "yellow", "orange", "red", "pink", "purple","navy", "blue", "teal", "green", "forest", "yellow", "orange", "red", "pink", "purple","navy", "blue", "teal", "green", "forest", "yellow", "orange", "red", "pink", "purple"];

  var graph5 = new Wisdom.Graphest({
    data: kairosFormatedData,
    wrapper: "#graphs5",
    area: true,
    stacked: true,
    colorClass: ["forest", "yellow", "pink"]
  });

  var graph = new Wisdom.Graphest({
    data: graphData,
    wrapper: "#graphs",
    area: true,
    stacked: true,
    colorClass: colors
  });

  var graph2 = new Wisdom.Graphest({
    data: graphData2,
    wrapper: "#graphs2",
    area: true,
    stacked: true,
    colorClass: colors
  });

  var graph3 = new Wisdom.Graphest({
    data: graphData3,
    wrapper: "#graphs3",
    area: false,
    stacked: true,
    colorClass: colors
  });

  var graph4 = new Wisdom.Graphest({
    data: graphData4,
    wrapper: "#graphs4",
    area: true,
    stacked: true,
    colorClass: ["red", "yellow", "pink"]
  });



  var toggleStacked = document.querySelector('#toggleStacked');

  toggleStacked.addEventListener('click', function(){
    graph.toggleStacked();
    graph2.toggleStacked();
    graph3.toggleStacked();
    graph4.toggleStacked();
    graph5.toggleStacked();
  });

  </script>
</body>
</html>